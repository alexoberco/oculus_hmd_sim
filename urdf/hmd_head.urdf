<?xml version="1.0"?>
<robot name="hmd_head">

  <!-- base -->
  <link name="base_link">
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
    <visual><geometry><cylinder radius="0.05" length="0.02"/></geometry></visual>
    <collision><geometry><cylinder radius="0.05" length="0.02"/></geometry></collision>
  </link>

  <!-- yaw -->
  <link name="neck_yaw_link">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0002" ixy="0" ixz="0" iyy="0.0002" iyz="0" izz="0.0002"/>
    </inertial>
    <visual><geometry><cylinder radius="0.03" length="0.06"/></geometry></visual>
    <collision><geometry><cylinder radius="0.03" length="0.06"/></geometry></collision>
  </link>
  <joint name="neck_yaw" type="revolute">
    <parent link="base_link"/><child link="neck_yaw_link"/>
    <origin xyz="0 0 0.06" rpy="0 0 0"/><axis xyz="0 0 1"/>
    <limit lower="-3.1415" upper="3.1415" effort="5" velocity="6.0"/>
    <dynamics damping="0.05"/>
  </joint>

  <!-- pitch -->
  <link name="neck_pitch_link">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0002" ixy="0" ixz="0" iyy="0.0002" iyz="0" izz="0.0002"/>
    </inertial>
    <visual><geometry><cylinder radius="0.03" length="0.06"/></geometry></visual>
    <collision><geometry><cylinder radius="0.03" length="0.06"/></geometry></collision>
  </link>
  <joint name="neck_pitch" type="revolute">
    <parent link="neck_yaw_link"/><child link="neck_pitch_link"/>
    <origin xyz="0 0 0.06" rpy="0 0 0"/><axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="5" velocity="6.0"/>
    <dynamics damping="0.05"/>
  </joint>

  <!-- roll -->
  <link name="head_link">
    <inertial>
      <mass value="0.4"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0004" ixy="0" ixz="0" iyy="0.0004" iyz="0" izz="0.0004"/>
    </inertial>
    <visual><geometry><sphere radius="0.08"/></geometry></visual>
    <collision><geometry><sphere radius="0.08"/></geometry></collision>
  </link>
  <joint name="head_roll" type="revolute">
    <parent link="neck_pitch_link"/><child link="head_link"/>
    <origin xyz="0 0 0.06" rpy="0 0 0"/><axis xyz="1 0 0"/>
    <limit lower="-1.57" upper="1.57" effort="5" velocity="6.0"/>
    <dynamics damping="0.05"/>
  </joint>

  <link name="indicator_x">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>

    <!-- Cilindro delgado (rojo) -->
    <visual>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
      <material name="red"><color rgba="1 0 0 1"/></material> <!-- rojo -->
    </visual>
    <collision>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
    </collision>
  </link>
  <joint name="head_to_indicator" type="fixed">
    <parent link="head_link"/>
    <child link="indicator_x"/>
    <origin xyz="0.16 0 0" rpy="0 1.5708 0"/>
  </joint>

  <link name="indicator_y">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
      <material name="indicator_green"><color rgba="0 1 0 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
    </collision>
  </link>

  <joint name="head_to_indicator_y" type="fixed">
    <parent link="head_link"/>
    <child link="indicator_y"/>
    <origin xyz="0 0.16 0" rpy="-1.5708 0 0"/>
  </joint>

  <link name="indicator_z">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>
    </inertial>
    <visual>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
      <material name="indicator_blue"><color rgba="0 0 1 1"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="0.01" length="0.16"/></geometry>
    </collision>
  </link>

  <!-- Sin rotación: el cilindro ya está alineado con +Z; lo adelantamos en +Z -->
  <joint name="head_to_indicator_z" type="fixed">
    <parent link="head_link"/>
    <child link="indicator_z"/>
    <origin xyz="0 0 0.16" rpy="0 0 0"/>
  </joint>

  <!-- === Sistemas de control de Gazebo Sim === -->
  <gazebo>
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>neck_yaw</joint_name>
      <topic>/gz/hmd/neck_yaw/cmd</topic>
      <p_gain>12</p_gain><i_gain>0.1</i_gain><d_gain>0.2</d_gain>
    </plugin>
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>neck_pitch</joint_name>
      <topic>/gz/hmd/neck_pitch/cmd</topic>
      <p_gain>12</p_gain><i_gain>0.1</i_gain><d_gain>0.2</d_gain>
    </plugin>
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>head_roll</joint_name>
      <topic>/gz/hmd/head_roll/cmd</topic>
      <p_gain>8</p_gain><i_gain>0.05</i_gain><d_gain>0.1</d_gain>
    </plugin>

    <!-- Publica estados de juntas (GZ Transport -> lo puenteamos a /joint_states) -->
    <plugin filename="gz-sim-joint-state-publisher-system"
            name="gz::sim::systems::JointStatePublisher">
      <joint_name>neck_yaw</joint_name>
      <joint_name>neck_pitch</joint_name>
      <joint_name>head_roll</joint_name>
    </plugin>
  </gazebo>
</robot>
